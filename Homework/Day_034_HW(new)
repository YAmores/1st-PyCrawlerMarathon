{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "colab_type": "text",
    "id": "I8CoX4R7VoCd"
   },
   "source": [
    "# 反爬：代理伺服器/IP\n",
    "\n",
    "* 了解「IP 黑/白名單」的反爬蟲機制\n",
    "* 「IP 黑/白名單」反爬蟲的因應策略"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {
    "colab_type": "text",
    "id": "n-3DZ_r5VoCe"
   },
   "source": [
    "## 作業目標\n",
    "\n",
    "* 目前程式中的 proxy_ips 是手動輸入的，請根據 https://free-proxy-list.net/ 寫一個可自動化抓取可用 Proxy 的 proxy_ips。\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 97,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "iny-9heBVoCf"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['124.41.243.22',\n",
       " '190.53.46.2',\n",
       " '193.200.151.69',\n",
       " '125.26.99.185',\n",
       " '217.219.172.8',\n",
       " '1.179.183.73',\n",
       " '62.201.220.50',\n",
       " '131.72.230.151',\n",
       " '36.67.66.100',\n",
       " '51.15.157.182',\n",
       " '186.159.3.41',\n",
       " '83.171.114.92',\n",
       " '185.74.4.47',\n",
       " '36.66.173.145',\n",
       " '212.83.157.111',\n",
       " '111.92.164.249',\n",
       " '85.237.46.168',\n",
       " '181.48.111.246',\n",
       " '36.94.35.217',\n",
       " '62.210.177.105',\n",
       " '182.253.115.66',\n",
       " '147.75.113.110',\n",
       " '103.111.55.210',\n",
       " '118.174.232.106',\n",
       " '109.224.55.10',\n",
       " '50.192.195.69',\n",
       " '91.211.172.104',\n",
       " '124.41.243.72',\n",
       " '207.191.165.8',\n",
       " '69.63.73.171',\n",
       " '170.238.255.90',\n",
       " '185.110.190.38',\n",
       " '92.255.248.230',\n",
       " '187.216.93.20',\n",
       " '182.52.90.42',\n",
       " '143.255.52.67',\n",
       " '80.253.247.45',\n",
       " '190.53.38.98',\n",
       " '144.217.101.245',\n",
       " '212.83.167.87',\n",
       " '94.141.233.66',\n",
       " '45.77.24.185',\n",
       " '190.152.182.150',\n",
       " '162.214.92.202',\n",
       " '51.75.147.43',\n",
       " '181.129.183.19',\n",
       " '167.172.212.197',\n",
       " '139.255.128.244',\n",
       " '36.67.106.58',\n",
       " '180.250.12.10',\n",
       " '37.79.254.152',\n",
       " '46.0.203.186',\n",
       " '103.52.171.165',\n",
       " '103.122.104.114',\n",
       " '167.71.5.83',\n",
       " '139.59.1.14',\n",
       " '138.68.60.8',\n",
       " '150.109.32.166',\n",
       " '173.212.202.65',\n",
       " '154.72.204.122',\n",
       " '62.182.114.164',\n",
       " '185.23.128.180',\n",
       " '41.32.229.249',\n",
       " '154.16.63.16',\n",
       " '5.252.161.48',\n",
       " '154.16.202.22',\n",
       " '139.99.102.114',\n",
       " '161.35.70.249',\n",
       " '191.96.71.118',\n",
       " '161.35.127.83',\n",
       " '62.195.186.231',\n",
       " '151.232.72.20',\n",
       " '151.232.72.21',\n",
       " '151.232.72.23',\n",
       " '123.252.173.162',\n",
       " '46.4.96.137',\n",
       " '89.248.244.180',\n",
       " '136.243.254.196',\n",
       " '51.15.145.112',\n",
       " '212.129.27.126',\n",
       " '52.29.166.153',\n",
       " '51.15.149.176',\n",
       " '138.219.23.248',\n",
       " '51.81.113.246',\n",
       " '165.22.66.91',\n",
       " '139.162.78.109',\n",
       " '103.78.254.78',\n",
       " '203.202.245.58',\n",
       " '198.199.86.11',\n",
       " '128.199.202.122',\n",
       " '134.209.29.120',\n",
       " '159.203.61.169',\n",
       " '191.96.42.80',\n",
       " '176.9.119.170',\n",
       " '102.129.249.120',\n",
       " '46.4.129.54',\n",
       " '103.76.50.195',\n",
       " '88.198.50.103',\n",
       " '103.115.14.43',\n",
       " '176.9.75.42',\n",
       " '45.4.85.73',\n",
       " '101.109.17.254',\n",
       " '183.88.129.49',\n",
       " '180.250.131.94',\n",
       " '78.37.27.139',\n",
       " '80.123.143.202',\n",
       " '187.45.123.137',\n",
       " '103.227.254.59',\n",
       " '118.174.233.45',\n",
       " '217.219.172.13',\n",
       " '95.181.37.114',\n",
       " '113.53.83.212',\n",
       " '93.91.112.247',\n",
       " '1.10.186.35',\n",
       " '118.172.201.59',\n",
       " '179.108.123.210',\n",
       " '193.233.9.167',\n",
       " '201.204.168.106',\n",
       " '91.203.36.102',\n",
       " '187.111.26.142',\n",
       " '46.150.76.25',\n",
       " '167.99.131.11',\n",
       " '195.239.178.110',\n",
       " '135.181.61.23',\n",
       " '79.101.98.2',\n",
       " '14.207.14.53',\n",
       " '1.20.99.89',\n",
       " '190.152.12.54',\n",
       " '41.65.174.85',\n",
       " '181.113.225.198',\n",
       " '163.172.230.144',\n",
       " '186.29.163.97',\n",
       " '89.107.197.173',\n",
       " '190.53.46.14',\n",
       " '103.240.206.152',\n",
       " '196.27.127.170',\n",
       " '176.63.205.248',\n",
       " '5.152.171.152',\n",
       " '187.243.255.174',\n",
       " '103.213.116.178',\n",
       " '118.97.235.234',\n",
       " '201.217.245.229',\n",
       " '96.9.86.70',\n",
       " '188.0.138.11',\n",
       " '109.75.42.231',\n",
       " '195.60.174.123',\n",
       " '178.20.137.178',\n",
       " '51.81.82.175',\n",
       " '181.129.70.82',\n",
       " '186.10.80.122',\n",
       " '118.174.233.40',\n",
       " '117.103.5.186',\n",
       " '95.143.8.182',\n",
       " '81.161.61.88',\n",
       " '115.77.191.180',\n",
       " '5.189.133.231',\n",
       " '45.248.43.33',\n",
       " '78.140.7.239',\n",
       " '162.208.48.84',\n",
       " '1.20.100.134',\n",
       " '163.172.127.248',\n",
       " '185.61.92.207',\n",
       " '96.9.77.71',\n",
       " '118.174.220.61',\n",
       " '196.0.34.142',\n",
       " '163.172.48.160',\n",
       " '14.192.31.4',\n",
       " '168.119.202.237',\n",
       " '217.219.31.210',\n",
       " '163.172.229.166',\n",
       " '109.195.194.79',\n",
       " '118.99.124.92',\n",
       " '203.150.128.79',\n",
       " '190.217.19.244',\n",
       " '103.110.7.83',\n",
       " '77.46.138.1',\n",
       " '79.143.225.152',\n",
       " '31.14.49.1',\n",
       " '31.41.92.154',\n",
       " '185.34.17.248',\n",
       " '108.165.247.216',\n",
       " '208.80.28.208',\n",
       " '125.141.117.24',\n",
       " '200.35.56.161',\n",
       " '51.15.158.253',\n",
       " '195.154.56.105',\n",
       " '202.45.146.210',\n",
       " '47.75.90.57',\n",
       " '157.230.103.91',\n",
       " '113.254.178.224',\n",
       " '102.67.153.24',\n",
       " '212.129.12.233',\n",
       " '103.92.225.98',\n",
       " '88.198.24.108',\n",
       " '175.212.226.55',\n",
       " '45.4.85.76',\n",
       " '176.36.89.203',\n",
       " '130.68.124.40',\n",
       " '209.97.150.167',\n",
       " '37.120.192.154',\n",
       " '46.175.70.69',\n",
       " '109.245.239.125',\n",
       " '182.160.124.26',\n",
       " '189.194.48.26',\n",
       " '175.106.10.226',\n",
       " '109.87.40.23',\n",
       " '195.154.47.113',\n",
       " '162.144.106.245',\n",
       " '91.188.129.63',\n",
       " '103.250.156.22',\n",
       " '96.9.73.80',\n",
       " '195.170.15.66',\n",
       " '31.220.183.217',\n",
       " '92.247.142.182',\n",
       " '190.11.15.14',\n",
       " '176.62.188.158',\n",
       " '103.9.188.229',\n",
       " '119.252.160.165',\n",
       " '181.196.254.202',\n",
       " '143.0.64.145',\n",
       " '103.21.161.105',\n",
       " '92.255.196.91',\n",
       " '200.116.198.222',\n",
       " '94.153.169.22',\n",
       " '147.78.160.2',\n",
       " '103.112.163.245',\n",
       " '163.172.231.193',\n",
       " '191.242.177.114',\n",
       " '119.82.252.122',\n",
       " '185.25.206.123',\n",
       " '128.199.151.120',\n",
       " '103.247.219.30',\n",
       " '134.209.23.176',\n",
       " '89.218.5.106',\n",
       " '192.117.146.110',\n",
       " '193.41.88.58',\n",
       " '78.47.16.54',\n",
       " '162.144.106.161',\n",
       " '41.65.201.174',\n",
       " '202.43.184.206',\n",
       " '80.48.119.28',\n",
       " '188.234.216.66',\n",
       " '85.234.38.166',\n",
       " '36.67.38.127',\n",
       " '168.228.195.90',\n",
       " '13.58.16.201',\n",
       " '85.62.10.82',\n",
       " '109.234.39.69',\n",
       " '89.248.244.182',\n",
       " '61.91.61.110',\n",
       " '190.171.180.162',\n",
       " '103.243.82.198',\n",
       " '170.254.224.7',\n",
       " '95.73.106.213',\n",
       " '181.211.245.74',\n",
       " '108.165.247.72',\n",
       " '178.252.166.210',\n",
       " '195.211.173.143',\n",
       " '103.112.163.207',\n",
       " '103.253.27.108',\n",
       " '191.242.177.118',\n",
       " '84.22.137.229',\n",
       " '212.77.138.161',\n",
       " '51.75.147.40',\n",
       " '2.56.9.204',\n",
       " '218.147.194.22',\n",
       " '80.253.247.43',\n",
       " '213.108.5.224',\n",
       " '105.27.238.165',\n",
       " '182.253.171.81',\n",
       " '212.129.35.67',\n",
       " '140.238.84.65',\n",
       " '41.162.52.11',\n",
       " '212.129.35.47',\n",
       " '169.239.223.136',\n",
       " '103.215.177.231',\n",
       " '158.255.57.174',\n",
       " '182.52.90.43',\n",
       " '154.72.202.62',\n",
       " '102.176.160.70',\n",
       " '93.117.72.27',\n",
       " '196.41.102.130',\n",
       " '35.238.111.107',\n",
       " '221.126.244.8',\n",
       " '202.40.188.90',\n",
       " '51.15.157.183',\n",
       " '142.44.148.56',\n",
       " '51.255.7.239',\n",
       " '105.27.237.31',\n",
       " '103.83.116.106',\n",
       " '89.109.23.122',\n",
       " '175.100.72.95',\n",
       " '103.227.255.43',\n",
       " '193.95.228.13',\n",
       " '36.67.253.135',\n",
       " '85.196.179.34',\n",
       " '103.109.59.242',\n",
       " '84.53.247.204',\n",
       " '212.83.183.33',\n",
       " '108.165.247.89']"
      ]
     },
     "execution_count": 97,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "proxy_ips = []\n",
    "\n",
    "\n",
    "import requests\n",
    "from bs4 import BeautifulSoup\n",
    "\n",
    "resp = requests.get('https://free-proxy-list.net/')\n",
    "soup = BeautifulSoup(resp.text, 'html5lib')\n",
    "\n",
    "for trs in soup.find(\"tbody\").find_all(\"tr\"):\n",
    "    proxy_ips.append(trs.find_all(\"td\")[0].text)\n",
    "        \n",
    "proxy_ips"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 100,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "75dIsHjiVoCi"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Use 190.152.12.54\n",
      "Fail\n",
      "Use 190.171.180.162\n",
      "Fail\n",
      "Use 89.218.5.106\n",
      "Fail\n",
      "Use 45.248.43.33\n",
      "Fail\n",
      "Use 91.203.36.102\n",
      "Fail\n",
      "Use 185.34.17.248\n",
      "Fail\n",
      "Use 118.97.235.234\n",
      "Fail\n",
      "Use 195.154.47.113\n",
      "Fail\n",
      "Use 182.52.90.43\n",
      "Fail\n",
      "Use 217.219.172.13\n",
      "Fail\n"
     ]
    }
   ],
   "source": [
    "import random\n",
    "\n",
    "for i in range(10):\n",
    "    ip = random.choice(proxy_ips)\n",
    "    print('Use', ip)\n",
    "    try:\n",
    "        resp = requests.get('http://ip.filefab.com/index.php',\n",
    "                        proxies={'http': ip, 'https': ip}, timeout=10)\n",
    "        soup = BeautifulSoup(resp.text, 'html5lib')\n",
    "        print(soup.find('h1', id='ipd').text.strip())\n",
    "    except:\n",
    "        print('Fail')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "colab": {
   "name": "homework.ipynb",
   "provenance": []
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
